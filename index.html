<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--STYLESHEET-->
    <link rel="stylesheet" href="index.css">
    <!--MATERIAL ICONS-->
    <link rel="stylesheet" href="https://fonts.sandbox.google.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@48,400,0,0"/>
    <title>Dashboard Responsivo</title>
</head>
<body>
    <div class="container">
        <main>
            <h1>Painel de recuperação</h1>

            <div class="date">
                <input type="date">
            </div>

            <div class="insights">
                <div class="sales">
                    <span class="material-symbols-sharp">
                        analytics
                    </span>

                    <div class="middle">
                       <div class="left">
                            <h3>Carrinhos abandonados</h3>
                            <h1></h1>
                       </div> 

                       <div class="progress">
                          
                    
                       </div>
                    </div>
                  
                </div>
                <!---------END OF SALES-------->
                    <div class="expenses">
                        <span class="material-symbols-sharp">
                            bar_chart
                        </span>
    
                        <div class="middle">
                           <div class="left">
                                <h3>Vendas recuperadas</h3>
                                <h1></h1>
                           </div> 
    
                           <div class="progress">
                              
                             
                           </div>
                        </div>
                    </div>
                   
                    <!---------END OF EXPENSES-------->
                        <div class="income">
                            <span class="material-symbols-sharp">
                                stacked_line_chart
                            </span>
        
                            <div class="middle">
                               <div class="left">
                                    <h3>Dinheiro recuperado</h3>
                                    <h1>R$10.864</h1>
                               </div> 
        
                               <div class="progress">
                                
                                   
                               </div>
                            </div>
                        </div>
                        <!---------END OF INCOME-------->
            </div>
            <!-- -------END INSIGHTS------- -->
            
            <div class="recent-orders">
                <table>
                    <thead>
                        <tr>
                            <th>Nome do cliente</th>
                            <th>Nome do Produto</th>
                            <th>codigo pagamento</th>
                            <th>Status</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Foldable Mini Drone</td>
                            <td>85631</td>
                            <td>Due</td>
                            <td class="primary">Pending</td>
                            <td class="primary">Details</td>
                        </tr>
                        <tr>
                            <td>LARVENDER KF102 Drone</td>
                            <td>36378</td>
                            <td>Due</td>
                            <td class="danger">Decline</td>
                            <td class="primary">Details</td>
                        </tr>
                        <tr>
                            <td>Ruko F11 Pro Drone</td>
                            <td>49347</td>
                            <td>Due</td>
                            <td class="primary">Pending</td>
                            <td class="primary">Details</td>
                        </tr>
                        <tr>
                            <td>Drone with Camera</td>
                            <td>96996</td>
                            <td>Paid</td>
                            <td class="primary">Delivired</td>
                            <td class="primary">Details</td>
                        </tr>
                        <tr>
                            <td>GPS 4k Drone</td>
                            <td>22821</td>
                            <td>Paid</td>
                            <td class="primary">Delivired</td>
                            <td class="primary">Details</td>
                        </tr>
                        <tr>
                            <td>DJI Air 2S</td>
                            <td>81475</td>
                            <td>Due</td>
                            <td class="primary">Pending</td>
                            <td class="primary">Details</td>
                        </tr>
                        <tr>
                            <td>Lazenge Drone</td>
                            <td>00482</td>
                            <td>Paid</td>
                            <td class="primary">Delivired</td>
                            <td class="primary">Details</td>
                        </tr>
                    </tbody>
                </table>
                <a href="#">Mostrar mais</a>
            </div>
        </main>
        <!-- -------------------- END MAIN -------------------- -->

        <div class="right">
            <div class="top">
                <button id="menu-btn">
                    <span class="material-symbols-sharp">
                        menu
                    </span>
                </button>
                <div class="themeToggler">
                    <span class="material-symbols-sharp active">
                        light_mode
                    </span>

                    <span class="material-symbols-sharp">
                        dark_mode
                    </span>
                </div>
                
            </div>
          
            <!-- --------------------- END OF RECENT UPDATES -------------------- -->
            
    <script src="./ordes.js"></script>
    <script src="./index.js"></script>
    <script>
   // Carregar dados ao abrir a página
document.addEventListener('DOMContentLoaded', () => {
    updateDashboard();
});

// Função para formatar valores em moeda brasileira
function formatCurrency(value) {
    return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}

// Atualizar dashboard com base na data selecionada
async function updateDashboard() {
    try {
        const selectedDate = document.querySelector('.date input').value;
        const [year, month] = selectedDate.split('-');

        // Buscar dados do status (carrinhos abandonados, vendas recuperadas, dinheiro recuperado)
        let statusResponse = await fetch(`https://e087b277-287a-4ff4-92e8-a32ea4585002-00-2t5s46lohir3m.janeway.replit.dev/dashboard?month=${month}&year=${year}`);
        let statusData = await statusResponse.json();

        // Atualizar o campo de carrinhos abandonados (sem formatação de moeda)
        document.querySelector('.sales h1').textContent = statusData.carrinhos_abandonados;

        // Atualizar o campo de vendas recuperadas (sem formatação de moeda)
        document.querySelector('.expenses h1').textContent = statusData.vendas_recuperadas;

        // Atualizar o campo de dinheiro recuperado com formatação de moeda
        document.querySelector('.income h1').textContent = formatCurrency(statusData.total_dinheiro_recuperado);

        // Buscar dados das vendas pendentes e atualizar tabela
        let vendasResponse = await fetch(`https://e087b277-287a-4ff4-92e8-a32ea4585002-00-2t5s46lohir3m.janeway.replit.dev/vendas-pendentes?month=${month}&year=${year}`);
        let vendasData = await vendasResponse.json();

        let tabelaVendas = document.querySelector('.recent-orders tbody');
        tabelaVendas.innerHTML = '';

        vendasData.forEach(venda => {
            let statusClass = venda.status === 'recuperado' ? 'primary' : 'danger';
            let statusLabel = venda.status === 'recuperado' ? 'Pago' : 'Pendente';

            let row = `
                <tr>
                    <td>${venda.full_name}</td> <!-- Nome do cliente -->
                    <td>${venda.produto}</td>  <!-- Nome do produto -->
                    <td>${venda.transaction_id}</td> <!-- Código de pagamento -->
                    <td class="${statusClass}">${statusLabel}</td>
                </tr>
            `;

            tabelaVendas.insertAdjacentHTML('beforeend', row);
        });

    } catch (error) {
        console.error('Erro ao atualizar o dashboard:', error);
    }
}

// Atualizar o dashboard a cada 10 segundos
setInterval(updateDashboard, 5 * 60 * 1000); // Atualiza a cada 5 minutos

    </script>
    
</body>
</html>
